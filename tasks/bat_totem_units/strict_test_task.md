# 蝙蝠图腾系列严格测试任务

## 任务概述
测试蝙蝠图腾系列的4个单位，按照严格测试规范进行实战测试。

## 测试环境
- 测试场景: `src/Scenes/Tests/TestBatTotemRuntime.tscn`
- 测试脚本: `src/Scripts/Tests/TestBatTotemRuntime.gd`
- 参考实现: `src/Scripts/Units/Behaviors/`

---

## 单位1: VampireBat (吸血蝠)

### 机制说明
- 生命值越低，吸血比例越高
- L1: 基础5%，低血额外10%
- L2: 基础8%，低血额外15%
- L3: 基础10%，低血额外20%

### 严格测试步骤

#### 放置测试
1. 放置vampire_bat L1于(0,0)
2. 验证无报错

#### 攻击测试（重点）
1. **满血测试**: core_health=100%，攻击敌人，验证吸血5%
2. **50%血测试**: core_health=50%，攻击敌人，验证吸血约7.5%
3. **25%血测试**: core_health=25%，攻击敌人，验证吸血约10%
4. **低血测试**: core_health=10%，攻击敌人，验证吸血约12.5%
5. 升级测试L2和L3的数值

#### 受击测试
1. 让敌人攻击核心降低血量
2. 验证低血量时吸血数值增加

---

## 单位2: PlagueSpreader (瘟疫使者)

### 机制说明
- 攻击使敌人中毒（5秒，20%伤害）
- 中毒敌人死亡时传播给附近最多3个敌人
- L2/L3增加传播范围

### 严格测试步骤

#### 放置测试
1. 放置plague_spreader于(0,0)
2. 验证无报错

#### 攻击测试（重点）
1. 攻击单个敌人，验证中毒效果（绿色浮动文字）
2. 在该敌人附近放置其他敌人（距离在传播范围内）
3. 让中毒敌人死亡，验证瘟疫传播
4. 验证最多传播3个敌人
5. 升级测试L2/L3的传播范围增加

#### 实战测试
- 运行30秒
- 观察中毒和传播链是否正常

---

## 单位3: BloodMage (血法师)

### 机制说明
- 主动技能：召唤血池区域（1x1/2x2/3x3）
- 血池持续8秒，对区域内敌人造成伤害
- 造成伤害的50%转化为核心治疗

### 严格测试步骤

#### 放置测试
1. 放置blood_mage于(0,0)
2. 验证无报错

#### 攻击测试（重点）
1. 在血法师周围放置多个敌人
2. 触发主动技能，选择血池位置
3. 验证血池视觉效果（血红色区域）
4. 验证血池内敌人受到伤害
5. 验证核心获得治疗（+%d HP浮动文字）
6. 升级测试L2(2x2)和L3(3x3, 效率增加)

#### 实战测试
- 运行30秒
- 验证技能冷却和多次释放

---

## 单位4: BloodAncestor (血祖)

### 机制说明
- 场上每有1个受伤敌人，自身攻击+10%/15%/20%
- L3时额外+20%吸血

### 严格测试步骤

#### 放置测试
1. 放置blood_ancestor于(0,0)
2. 验证无报错

#### 攻击测试（重点）
1. **无受伤敌人**: 验证基础攻击力
2. **1个受伤敌人**: 放置敌人并打伤（不杀死），验证攻击+10%
3. **多个受伤敌人**: 放置3个受伤敌人，验证攻击+30%
4. 验证浮动文字显示当前加成
5. L3时验证吸血效果

#### 实战测试
- 运行30秒
- 验证加成随敌人状态动态变化

---

## 输出要求

1. `tasks/bat_totem_units/strict_test_result.md`
2. `tasks/bat_totem_units/pitfalls.md`
3. 更新`progress.md`

## 注意事项
- BloodMage使用`Constants.TILE_SIZE`而不是`get_tree()`
- 测试吸血时注意观察浮动文字
- 血池技能需要手动触发测试
