# 牛图腾系列严格测试任务

## 任务概述
测试牛图腾系列的4个单位，按照严格测试规范进行实战测试。

## 测试环境
- 测试场景: `src/Scenes/Tests/TestCowTotemRuntime.tscn`
- 测试脚本: `src/Scripts/Tests/TestCowTotemRuntime.gd`
- 参考实现: `src/Scripts/Units/Behaviors/`

---

## 单位1: YakGuardian (牦牛守护)

### 机制说明
- 自身周围1格范围内友方受到伤害减少5%/10%/15%
- 通过broadcast_buffs给周围友方添加guardian_shield buff

### 严格测试步骤

#### 放置测试
1. 在棋盘(0,0)位置放置yak_guardian L1
2. 验证控制台无报错
3. 验证单位图标和名称正确显示

#### 攻击测试
1. 在yak_guardian周围1格内（如(0,1)）放置另一个友方单位（如squirrel）
2. 在squirrel攻击范围内放置敌人
3. 观察squirrel攻击是否正常

#### 受击测试（重点）
1. 在yak_guardian周围1格内放置友方单位squirrel
2. 在squirrel旁边放置敌人，让敌人攻击squirrel
3. 验证squirrel受到的伤害是否正确减少5%（L1）
4. 升级yak_guardian到L2，验证减伤10%
5. 升级yak_guardian到L3，验证减伤15%

#### 实战测试
- 运行30秒，观察是否有报错
- 验证buff是否正确施加和移除

---

## 单位2: MushroomHealer (菌菇治愈者)

### 机制说明
- 核心受到治疗时，超出上限部分转化为延迟回血
- 转化比例80%，L3增加50%转化量
- 延迟3秒后释放

### 严格测试步骤

#### 放置测试
1. 在棋盘(0,0)位置放置mushroom_healer L1
2. 验证控制台无报错

#### 攻击测试
1. 观察单位是否正常攻击敌人
2. 主动技能：测试立即释放存储的治疗量

#### 受击测试（重点）
1. 先将核心生命值降低到50%
2. 使用cow_totem核心的治疗或其他方式治疗核心
3. 当核心满血后继续治疗，验证溢出治疗被转化为延迟回血
4. 等待3秒，验证延迟回血是否正确释放
5. 测试L3时转化量增加50%

#### 实战测试
- 运行30秒
- 观察延迟回血队列是否正常工作

---

## 单位3: RockArmorCow (岩甲牛)

### 机制说明
- 脱战5/4/3秒后生成最大生命值10%/15%/20%的护盾
- 护盾可吸收伤害，被打破时显示"岩盾破碎"

### 严格测试步骤

#### 放置测试
1. 在棋盘(0,0)位置放置rock_armor_cow L1
2. 验证控制台无报错

#### 攻击测试
1. 在攻击范围内放置敌人
2. 验证单位正常攻击

#### 受击测试（重点）
1. 放置rock_armor_cow，等待5秒让其生成护盾
2. 验证护盾视觉效果出现
3. 放置敌人攻击rock_armor_cow
4. 验证护盾吸收伤害（显示"护盾 -X"）
5. 持续攻击直到护盾破碎，验证"岩盾破碎"提示
6. 攻击停止后，验证脱战计时重新开始
7. 升级测试L2(4秒,15%)和L3(3秒,20%)

#### 实战测试
- 运行30秒
- 验证护盾生成和破碎循环正常

---

## 单位4: CowGolem (牛魔像)

### 机制说明
- 每受到15/12/10次攻击触发全屏震荡
- 晕眩所有敌人1/1/1.5秒

### 严格测试步骤

#### 放置测试
1. 在棋盘(0,0)位置放置cow_golem L1
2. 验证控制台无报错

#### 攻击测试
1. 在攻击范围内放置敌人
2. 验证单位正常攻击

#### 受击测试（重点）
1. 放置cow_golem L1
2. 在周围放置多个快速攻击的敌人（如slime）
3. 观察cow_golem受击次数
4. 验证受击15次后触发"震荡反击!"全屏眩晕
5. 验证所有敌人被眩晕1秒
6. 计数器重置后继续测试
7. 升级测试L2(12次)和L3(10次,1.5秒)

#### 实战测试
- 运行30秒
- 验证震荡触发稳定性

---

## 输出要求

完成测试后，更新以下文件：
1. `tasks/cow_totem_units/strict_test_result.md` - 详细测试结果
2. `tasks/cow_totem_units/pitfalls.md` - 新发现的问题和解决方案
3. 在`progress.md`中更新牛图腾测试状态

## 测试报告模板

```markdown
### YakGuardian 测试结果
- 放置测试: ✅/❌
- 攻击测试: ✅/❌
- 受击测试: ✅/❌
- 实战测试: ✅/❌
- 备注: [问题描述]

### MushroomHealer 测试结果
...

### RockArmorCow 测试结果
...

### CowGolem 测试结果
...
```

## 注意事项
1. 使用 `unit.get_tree()` 而不是 `get_tree()`
2. 测试前清理之前的测试单位和敌人
3. 每个等级都要测试（L1, L2, L3）
4. 运行Godot时注意观察控制台输出
