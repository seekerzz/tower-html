# ç‰›å›¾è…¾ç³»åˆ—å•ä½ä¿®å¤å®ŒæˆæŠ¥å‘Š

## ä¿®å¤æ¦‚è¿°

æœ¬æ¬¡ä¿®å¤é‡æ–°å®ç°äº†ç‰›å›¾è…¾ç³»åˆ—çš„4ä¸ªå•ä½ï¼Œè§£å†³äº†åŸæœ‰å®ç°ä¸­çš„é—®é¢˜ã€‚

---

## 1. yak_guardian (ç‰¦ç‰›å®ˆæŠ¤)

### ä¿®å¤å‰é—®é¢˜
- **game_data.json**: `attackType` æ˜¯ `"melee"`ï¼Œåº”è¯¥æ˜¯ `"none"`
- **è„šæœ¬é€»è¾‘**: åªå‡å°‘è‡ªèº«å—åˆ°çš„ä¼¤å®³ï¼Œä½†æŒ‰ç…§è®¾è®¡åº”è¯¥æ˜¯å‡å°‘å‘¨å›´1æ ¼å‹æ–¹å—åˆ°çš„ä¼¤å®³

### ä¿®å¤å†…å®¹
1. **game_data.json ä¿®æ”¹**:
   - `attackType`: `"melee"` -> `"none"`
   - `range`: `80` -> `0`
   - `atkSpeed`: `1.0` -> `0`
   - `damage`: æ‰€æœ‰ç­‰çº§è®¾ä¸º `0`
   - `crit_rate`: `0.1` -> `0.0`

2. **YakGuardian.gd é‡å†™**:
   - å®ç°äº† `broadcast_buffs()` æ–¹æ³•ï¼Œå‘å‘¨å›´1æ ¼å‹æ–¹æä¾› `guardian_shield` buff
   - æ·»åŠ äº† `get_damage_reduction()` æ–¹æ³•ä¾›è¢«ä¿æŠ¤å•ä½æŸ¥è¯¢å‡ä¼¤æ¯”ä¾‹
   - ä½¿ç”¨ `_get_units_in_range()` è·å–èŒƒå›´å†…çš„å‹æ–¹å•ä½

3. **Unit.gd ä¿®æ”¹**:
   - åœ¨ `take_damage()` ä¸­æ·»åŠ äº† `guardian_shield` buff çš„å¤„ç†é€»è¾‘
   - åœ¨ `apply_buff()` ä¸­æ·»åŠ äº† `guardian_shield` çš„åŒ¹é…åˆ†æ”¯

### æ­£ç¡®æœºåˆ¶
è‡ªèº«å‘¨å›´1æ ¼èŒƒå›´å†…å‹æ–¹å—åˆ°ä¼¤å®³å‡å°‘5%/10%/15%

---

## 2. mushroom_healer (èŒè‡æ²»æ„ˆè€…)

### ä¿®å¤å‰é—®é¢˜
- è„šæœ¬ç¼ºå°‘ä¸ GameManager æ ¸å¿ƒæ²»ç–—äº‹ä»¶çš„è¿æ¥
- `process_core_heal` å‡½æ•°ä»æœªè¢«è°ƒç”¨

### ä¿®å¤å†…å®¹
1. **MushroomHealer.gd é‡å†™**:
   - æ”¹ç”¨ç›‘å¬æ ¸å¿ƒç”Ÿå‘½å€¼å˜åŒ–çš„æ–¹å¼æ¥æ£€æµ‹æ²»ç–—äº‹ä»¶
   - æ·»åŠ äº† `last_core_health` å˜é‡è·Ÿè¸ªæ ¸å¿ƒç”Ÿå‘½å€¼å˜åŒ–
   - åœ¨ `on_tick()` ä¸­æ£€æµ‹æ²»ç–—å¹¶è°ƒç”¨ `_process_core_heal()`
   - å®ç°äº†å»¶è¿Ÿå›è¡€é˜Ÿåˆ— `delayed_heal_queue`
   - æ¯ç§’é’Ÿé‡Šæ”¾ä¸€æ¬¡åˆ°æœŸçš„å»¶è¿Ÿå›è¡€

### æ­£ç¡®æœºåˆ¶
æ ¸å¿ƒå—åˆ°æ²»ç–—æ—¶ï¼Œè¶…å‡ºä¸Šé™éƒ¨åˆ†è½¬åŒ–ä¸ºå»¶è¿Ÿå›è¡€ï¼ˆ3ç§’åé‡Šæ”¾ï¼‰
- L1: æº¢å‡ºæ²»ç–—è½¬åŒ–80%
- L2: æº¢å‡ºæ²»ç–—è½¬åŒ–100%
- L3: æº¢å‡ºæ²»ç–—è½¬åŒ–100%ï¼Œä¸”è½¬åŒ–é‡+50%

---

## 3. rock_armor_cow (å²©ç”²ç‰›)

### ä¿®å¤å‰é—®é¢˜
- è„±æˆ˜é€»è¾‘é”™è¯¯ï¼šåœ¨ `in_combat` ä¸º true æ—¶è®¡æ—¶ï¼Œåº”è¯¥åœ¨ false æ—¶è®¡æ—¶
- è„±æˆ˜åæ— æ³•æ­£ç¡®ç”ŸæˆæŠ¤ç›¾

### ä¿®å¤å†…å®¹
1. **game_data.json ä¿®æ”¹**:
   - L2 çš„ `out_of_combat_time`: `3.0` -> `4.0`ï¼ˆç¬¦åˆè®¾è®¡ï¼š5/4/3ç§’ï¼‰

2. **RockArmorCow.gd ä¿®å¤**:
   - ä¿®å¤äº†è„±æˆ˜é€»è¾‘ï¼šç°åœ¨åœ¨ä¸å¤„äºæˆ˜æ–—çŠ¶æ€æ—¶è®¡æ—¶
   - åˆå§‹çŠ¶æ€è®¾ä¸º `in_combat = false`ï¼Œè®©å•ä½å¯ä»¥ç«‹å³å¼€å§‹è„±æˆ˜è®¡æ—¶
   - æ·»åŠ äº† `on_combat_tick()` æ–¹æ³•ï¼Œåœ¨æ”»å‡»æ—¶ä¹Ÿè¿›å…¥æˆ˜æ–—çŠ¶æ€
   - ä¼˜åŒ–äº†æŠ¤ç›¾è§†è§‰æ•ˆæœï¼Œé¿å…é‡å¤åˆ›å»º

### æ­£ç¡®æœºåˆ¶
è„±ç¦»æˆ˜æ–—5/4/3ç§’åç”Ÿæˆæœ€å¤§ç”Ÿå‘½å€¼10%/15%/20%çš„æŠ¤ç›¾

---

## 4. cow_golem (ç‰›é­”åƒ)

### ä¿®å¤å‰é—®é¢˜
- game_data.json ä¸­å®Œå…¨ç¼ºå¤±è¿™ä¸ªå•ä½
- è¡Œä¸ºè„šæœ¬é€»è¾‘åŸºæœ¬æ­£ç¡®ä½†éœ€è¦ä¼˜åŒ–

### ä¿®å¤å†…å®¹
1. **game_data.json æ–°å¢**:
   ```json
   "cow_golem": {
       "name": "ç‰›é­”åƒ",
       "icon": "ğŸ—¿",
       "size": [1, 1],
       "range": 0,
       "atkSpeed": 0,
       "manaCost": 0,
       "attackType": "none",
       "levels": {
           "1": { "hp": 800, "cost": 80, "mechanics": { "hits_threshold": 15, "stun_duration": 1.0 } },
           "2": { "hp": 1200, "cost": 160, "mechanics": { "hits_threshold": 12, "stun_duration": 1.0 } },
           "3": { "hp": 1800, "cost": 320, "mechanics": { "hits_threshold": 10, "stun_duration": 1.5 } }
       }
   }
   ```

2. **CowGolem.gd ä¼˜åŒ–**:
   - ä¼˜åŒ–äº† `_update_mechanics()` çš„æ•°æ®è·å–é€»è¾‘
   - æ·»åŠ äº† `is_instance_valid()` æ£€æŸ¥é¿å…æ“ä½œå·²é‡Šæ”¾çš„æ•Œäºº
   - æ·»åŠ äº† `get_hit_counter()` å’Œ `get_hits_threshold()` ä¾›UIæ˜¾ç¤º

### æ­£ç¡®æœºåˆ¶
æ¯å—åˆ°15/12/10æ¬¡æ”»å‡»è§¦å‘å…¨å±éœ‡è¡ï¼Œæ™•çœ©1/1/1.5ç§’

---

## æ–‡ä»¶ä¿®æ”¹åˆ—è¡¨

### ä¿®æ”¹çš„æ–‡ä»¶
1. `/home/zhangzhan/tower-html/data/game_data.json`
   - ä¿®æ”¹ `yak_guardian` é…ç½®
   - ä¿®æ”¹ `rock_armor_cow` L2 çš„è„±æˆ˜æ—¶é—´
   - æ–°å¢ `cow_golem` é…ç½®

2. `/home/zhangzhan/tower-html/src/Scripts/Unit.gd`
   - ä¿®æ”¹ `take_damage()` æ·»åŠ  guardian_shield å¤„ç†
   - ä¿®æ”¹ `apply_buff()` æ·»åŠ  guardian_shield åˆ†æ”¯

3. `/home/zhangzhan/tower-html/src/Scripts/Units/Behaviors/YakGuardian.gd` (é‡å†™)
4. `/home/zhangzhan/tower-html/src/Scripts/Units/Behaviors/MushroomHealer.gd` (é‡å†™)
5. `/home/zhangzhan/tower-html/src/Scripts/Units/Behaviors/RockArmorCow.gd` (ä¿®å¤)
6. `/home/zhangzhan/tower-html/src/Scripts/Units/Behaviors/CowGolem.gd` (ä¼˜åŒ–)

---

## æµ‹è¯•å»ºè®®

1. **yak_guardian**: æ”¾ç½®å•ä½åï¼Œè®©å‘¨å›´å‹æ–¹å—åˆ°ä¼¤å®³ï¼Œæ£€æŸ¥æ˜¯å¦æ­£ç¡®å‡ä¼¤
2. **mushroom_healer**: åœ¨æ ¸å¿ƒæ»¡è¡€æ—¶æ²»ç–—æ ¸å¿ƒï¼Œæ£€æŸ¥æ˜¯å¦äº§ç”Ÿå»¶è¿Ÿå›è¡€
3. **rock_armor_cow**: æ”¾ç½®å•ä½åä¸æ”»å‡»ï¼Œç­‰å¾…5ç§’æ£€æŸ¥æ˜¯å¦ç”ŸæˆæŠ¤ç›¾
4. **cow_golem**: è®©æ•Œäººæ”»å‡»è¯¥å•ä½15æ¬¡ï¼Œæ£€æŸ¥æ˜¯å¦è§¦å‘å…¨å±æ™•çœ©

---

## æ³¨æ„äº‹é¡¹

1. **guardian_shield buff**: è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„buffï¼Œå…¶æ•ˆæœåœ¨ `Unit.take_damage()` ä¸­å¤„ç†ï¼Œè€Œä¸æ˜¯åœ¨ `apply_buff()` ä¸­
2. **mushroom_healer**: é€šè¿‡ç›‘å¬ `GameManager.core_health` å˜åŒ–æ¥æ£€æµ‹æ²»ç–—ï¼Œè¿™æ„å‘³ç€ä»»ä½•æ²»ç–—æ–¹å¼ï¼ˆåŒ…æ‹¬å…¶ä»–å•ä½çš„æ²»ç–—ï¼‰éƒ½ä¼šè§¦å‘è½¬åŒ–
3. **rock_armor_cow**: è„±æˆ˜è®¡æ—¶å™¨åœ¨ `on_tick()` ä¸­æ›´æ–°ï¼Œç¡®ä¿æ¸¸æˆè¿è¡Œæ—¶ä¼šæ­£ç¡®è®¡æ—¶
4. **cow_golem**: å—å‡»è®¡æ•°åœ¨ `on_damage_taken()` ä¸­å¢åŠ ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡å—åˆ°ä¼¤å®³éƒ½ä¼šè®¡æ•°ï¼Œæ— è®ºä¼¤å®³å¤§å°
